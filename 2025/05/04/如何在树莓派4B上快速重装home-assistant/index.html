<html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="<blockquote>
<p>home-assistant（HA）是一个Python编写的开源智能家居中枢系统，可以运行在各种各样的硬件上，甚至包括树莓派和软路由，官方为边缘计算设备还推出了打包好HA的操作系统，HA
OS。然而，最近的HAOS在树莓派4B上会遇到bug，无法启动。每当更新系统失败的时候就需要重装，回滚到正常的版本。本文作为备忘录记录树莓派安装HAOS的流程和常见问题。</p>
</blockquote>"><title>如何在树莓派4B上快速重装home-assistant - Cerallin的笔记本 - 瞎折腾～～</title><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="/notes/css/style.css"><link rel="stylesheet" href="/notes/css/helpers.css"><script src="/notes/js/clipboard/clipboard.min.js"></script><script src="/notes/js/bootstrap.js"></script><script>Theme.counter={register:function(){request("//visitor-counter.cerallin.top/count.php/?page="+encodeURI(window.location.href),{method:"GET"}).then(e=>{for(var t in e){var n=document.getElementById(t);n&&(n.innerText=e[t])}}).catch(e=>{console.error("Fetching visit count failed.",e)})}}</script><style>body hl:after {
    content: ' ';
    display: inline;
    font-family: inherit;
    font-size: 0.45em;
}

html code hl,
html pre hl,
html kbd hl,
html samp hl,
html ruby hl,
html .tag-list-item hl {
    display: none;
}

html ol > hl,
html ul > hl {
    display: none;
}</style><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/notes/atom.xml" title="Cerallin的笔记本" type="application/atom+xml"></head><body><div class="loading-wrapper" data-loading="data-loading"><div class="loading"><span></span><span></span><span></span></div></div><div class="page" data-filter="data-filter"><div class="head" data-show="data-show"><header class="head-header"><div class="head-author"><a class="head-author-link" href="/notes/">Cerallin<hl></hl>的笔记本</a></div><div class="head-right"><button class="bar-wrap" id="bar-wrap-toggle" title="菜单按钮"><span class="bar"></span><span class="bar"></span><span class="bar"></span></button><div class="head-item"><a class="search-button head-item-link"><span>搜索</span> <i class="icon icon-search"></i></a></div><div class="head-item"><a class="head-item-link" href="/notes/about">关于</a></div></div></header><div class="menubar-head" id="menubar"><ul class="menubar-ul"><li class="menubar-item"><i class="icon icon-chevron-right"></i> <a class="menubar-link" href="/notes/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%B7%A5%E7%A8%8B/">计算机与通信工程</a></li><li class="menubar-item"><i class="icon icon-chevron-right"></i> <a class="menubar-link" href="/notes/categories/%E6%9D%90%E6%96%99%E7%A7%91%E5%AD%A6%E4%B8%8E%E5%B7%A5%E7%A8%8B/">材料科学与工程</a></li><li class="menubar-item"><i class="icon icon-chevron-right"></i> <a class="menubar-link" href="/notes/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/">瞎折腾</a></li><li class="menubar-item"><i class="icon icon-chevron-right"></i> <a class="menubar-link" href="/notes/categories/%E6%B5%85%E6%80%9D/">浅思</a></li><li class="menubar-item" data-border="data-border"></li><li class="menubar-item"><i class="icon icon-archive"></i> <a class="menubar-link" href="/notes/archives">归档</a></li><li class="menubar-item"><i class="icon icon-tags"></i> <a class="menubar-link" href="/notes/tags">标签</a></li><li class="menubar-item" data-border="data-border"></li><li class="menubar-item"><a class="menubar-link" href="/notes/about"><span>关于</span></a></li></ul><div class="menu-search-box search-button"><div>搜索</div><i class="icon icon-search"></i></div></div></div><div class="main" data-page="post"><article class="post" id="post"><header class="post-head"><h1 class="post-title"><a class="title" href="/notes/2025/05/04/%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%91%E8%8E%93%E6%B4%BE4B%E4%B8%8A%E5%BF%AB%E9%80%9F%E9%87%8D%E8%A3%85home-assistant/">如何在树莓派<hl></hl>4B<hl></hl>上快速重装<hl></hl>home-assistant</a></h1></header><div class="post-meta"><div class="post-date"><time class="post-time" itemprop="datePublished" title="2025-05-04 08:56:15" datetime="2025-05-04T00:56:15.000Z">2025-05-04</time></div>|<div class="post-tag"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/notes/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/notes/tags/home-assistant/" rel="tag">home-assistant</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/notes/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag"><hl></hl>树莓派</a></li></ul></div><div class="post-visit"><span id="page_pv">?</span><hl></hl>访问</div></div><div class="post-info"><div class="post-word-count">本文共<hl></hl>1,172<hl></hl>字。</div><div class="post-cc">版权声明：署名 | <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a></div></div><div class="article-entry" itemprop="articleBody"><blockquote><p>home-assistant（HA）是一个<hl></hl>Python<hl></hl>编写的开源智能家居中枢系统，可以运行在各种各样的硬件上，甚至包括树莓派和软路由，官方为边缘计算设备还推出了打包好<hl></hl>HA<hl></hl>的操作系统，HA OS。然而，最近的<hl></hl>HAOS<hl></hl>在树莓派<hl></hl>4B<hl></hl>上会遇到<hl></hl>bug，无法启动。每当更新系统失败的时候就需要重装，回滚到正常的版本。本文作为备忘录记录树莓派安装<hl></hl>HAOS<hl></hl>的流程和常见问题。</p></blockquote><span id="more"></span><h3 id="准备工作">准备工作</h3><h4 id="硬件准备">硬件准备</h4><p>安装教程可以参考<hl></hl><a target="_blank" rel="noopener" href="https://www.home-assistant.io/installation/raspberrypi/">HA<hl></hl>官方网站</a></p><ul><li>树莓派<hl></hl>4B<hl></hl>及以上（3B+<hl></hl>及以下没有足够内存）</li><li>SD<hl></hl>卡读卡器（用来连接电脑烧录系统进去）</li><li>网线（HA OS<hl></hl>初始化的时候必须先用网线连接，之后可以无线连接）</li></ul><h4 id="网络环境">网络环境</h4><p>网络环境需要满足以下几点要求：</p><ul><li>能访问外网</li><li>能访问<hl></hl>docker.io</li></ul><p>在安装之前一定要配置好透明代理。HA OS<hl></hl>初始化的时候并不能设置代理，至少我没有找到方法。</p><h3 id="安装步骤">安装步骤</h3><h4 id="烧录系统5-min">烧录系统（5 min）</h4><p>首先去<hl></hl><a target="_blank" rel="noopener" href="https://github.com/home-assistant/operating-system/releases">HA OS Github Release 页</a>下载合适版本的镜像，比如<hl></hl>haos_rpi4-64-15.0.img.xz。名字里的数字依次表示树莓派<hl></hl>4、64<hl></hl>位操作系统、15.0<hl></hl>版本。</p><details><summary><span>如果想安装最新的<hl></hl>HA OS<hl></hl>系统，可以不从<hl></hl>Github<hl></hl>下载。</span></summary><p>本教程写作的现在，HA OS<hl></hl>最新的两个版本<hl></hl>15.2<hl></hl>和<hl></hl>15.1，都会导致树莓派<hl></hl>4<hl></hl>黑屏，恶性<hl></hl>bug。因此，不得不先手动下载无害的<hl></hl>15.0<hl></hl>版本。</p></details><p>然后使用树莓派官方烧录器，如<a href="#fig:rpi-imager">图<hl></hl>1</a><hl></hl>所示，从左到右依次选择：</p><ul><li>设备：Raspberry Pi 4；</li><li>操作系统：拉到最下面选<hl></hl>“Use Custom”，然后从文件管理器里选择刚才下载的系统镜像；</li><li>SD<hl></hl>卡：可不要选到硬盘去了。</li></ul><figure id="fig:rpi-imager"><img loading="lazy" src="/notes/images/raspberry-imager.png" class="fig-ref" alt="图1: 树莓派官方镜像烧录器，Raspberry Pi Imager"><figcaption aria-hidden="true">图<hl></hl>1: 树莓派官方镜像烧录器，Raspberry Pi Imager</figcaption></figure><p>全部选择完毕后点击<hl></hl>Next，如果弹窗问是否保存默认用户配置，就<hl></hl>“下次一定”，因为<hl></hl>HA OS<hl></hl>没有机会设置自定义的用户名之类的。</p><p>如果想安装最新版的<hl></hl>HA OS，在烧录器页面选操作系统的时候，可以选<hl></hl>“Other specific-purpose OS -&gt; Home assistants and home automation -&gt; Home Assistant”。</p><h4 id="初始化与备份恢复120-min">初始化与备份恢复（120 min）</h4><p>插入<hl></hl>SD<hl></hl>卡、网线，通电。等待最多<hl></hl>5<hl></hl>分钟，就可以访问<hl></hl>HA<hl></hl>的网页了。等待期间可以上路由器找一下树莓派的<hl></hl>IP<hl></hl>地址，或者确认一下内网域名是<hl></hl>lan<hl></hl>还是<hl></hl>local。通过<hl></hl><code>homeassistant.local:8123</code><hl></hl>或者<hl></hl><code>IP<hl></hl>地址:8123</code><hl></hl>访问<hl></hl>HA<hl></hl>网页，可以看到初始化进度。此时还需等待至少<hl></hl>20<hl></hl>分钟……</p><p>初始化成功后，选择从备份恢复。没备份就跳过此步。上传相应的备份，有密码的话还要输入密码。从备份恢复往往需要若干小时……</p><h4 id="启用i2c10-min">启用<hl></hl>I2C（10 min）</h4><p>终于进入<hl></hl>HA<hl></hl>系统了！熟悉得就像在家里一样。（本来就在家里吧）</p><p>为了监控电池电量，我安装了一个<a target="_blank" rel="noopener" href="https://github.com/odya/hass-ina219-ups-hat">基于<hl></hl>I2C<hl></hl>的插件</a>。但是，每次重装之后都需要先重新启用<hl></hl>I2C<hl></hl>功能。</p><p>我使用<a target="_blank" rel="noopener" href="https://community.home-assistant.io/t/add-on-hassos-i2c-configurator/264167">这篇帖子</a>里介绍的<a target="_blank" rel="noopener" href="https://github.com/adamoutler/HassOSConfigurator">这个加载项</a>修改启用<hl></hl>I2C，步骤如下：</p><a target="_blank" href="https://my.home-assistant.io/redirect/supervisor_add_addon_repository/?repository_url=https%3A%2F%2Fgithub.com%2Fadamoutler%2FHassOSConfigurator" class="link-card"><span class="link-card-title">点我一键跳转<hl></hl></span><span class="link-card-link"><span class="link-card-icon"><i class="icon icon-link-45deg"></i></span><span>https://my.home-assistant.io/redirect/supervisor_add_addon_repository/?repository_url=https%3A%2F%2Fgithub.com%2Fadamoutler%2FHassOSConfigurator</span></span></a><ol type="1"><li>点击上方神秘链接添加加载项仓库到<hl></hl>HA。注意下方可以选择<hl></hl>HA<hl></hl>网页地址。</li><li>在<hl></hl>HA<hl></hl>里选择<hl></hl>“设置 -&gt; 加载项 -&gt; 搜索<hl></hl>I2C -&gt; HassOS I2C Configurator -&gt; 安装”。</li><li>静静地等待转圈圈，此时不能乱动否则需要从头安装。迟迟安装不上请检查网络环境。</li><li>关闭该加载项的<hl></hl>“保护模式”，然后启动。</li><li>循环<hl></hl>2-3<hl></hl>次：硬重启-&gt;<hl></hl>启动该加载项-&gt;<hl></hl>硬重启-&gt;<hl></hl>启动该加载项。</li></ol><p>据加载项作者说，一共需要重启两次，一次是为了让配置落盘，一次是让<hl></hl>HA<hl></hl>以更新了的配置启动。但我每次都要重启三次才好使。</p><h3 id="总结">总结</h3><p>本文介绍了树莓派<hl></hl>4B<hl></hl>上<hl></hl>home-assistant<hl></hl>的快速重装方法。方法是通用的，树莓派<hl></hl>5<hl></hl>也可以用。观察<hl></hl>HA OS<hl></hl>的<hl></hl>Github<hl></hl>页面可知，各种树莓派上时不时就会有无法启动<hl></hl>/<hl></hl>启动慢的问题。</p><p>这个故事告诉我们<hl></hl>HA OS<hl></hl>升级需谨慎。</p><h3 data-toc-unnumbered="true" id="附录树莓派无法启动的表现">附录：树莓派无法启动的表现</h3><p>树莓派上电之后红灯常亮，绿灯闪烁。 10<hl></hl>分钟之后绿灯常亮，偶尔闪烁。如果接屏幕启动，屏幕一直黑屏。 <span class="display-block text-indent-none mt-4 mb-2 fw-600">Fin.</span></p></div></article><aside class="post-widget"><h4>目录<hl></hl></h4><nav class="post-toc-wrap" id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="post-toc-number">1.</span> <span class="post-toc-text">准备工作<hl></hl></span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%A1%AC%E4%BB%B6%E5%87%86%E5%A4%87"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">硬件准备<hl></hl></span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">网络环境<hl></hl></span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="post-toc-number">2.</span> <span class="post-toc-text">安装步骤<hl></hl></span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%83%A7%E5%BD%95%E7%B3%BB%E7%BB%9F5-min"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">烧录系统（5 min）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%8E%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D120-min"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">初始化与备份恢复（120 min）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%90%AF%E7%94%A8i2c10-min"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">启用<hl></hl>I2C（10 min）</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93"><span class="post-toc-number">3.</span> <span class="post-toc-text">总结</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%99%84%E5%BD%95%E6%A0%91%E8%8E%93%E6%B4%BE%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E7%9A%84%E8%A1%A8%E7%8E%B0"><span class="post-toc-text">附录：树莓派无法启动的表现<hl></hl></span></a></li></ol></nav></aside></div><footer class="footer-nav"><div class="footer"><div class="back-top" id="back-top" title="Back to top"><i class="icon icon-chevron-bar-up"></i></div><div class="footer-content"><div class="footer-links"><div class="footer-links-column"><p><a title="Google Scholar" target="_blank" rel="noopener" href="https://scholar.google.com/">Google Scholar</a></p><p><a title="Google patents" target="_blank" rel="noopener" href="https://patents.google.com/">Google patents</a></p><p><a title="Bing Academic" target="_blank" rel="noopener" href="https://bing.com/academic/">Bing Academic</a></p></div><div class="footer-links-column"><p><a title="Web of Science" target="_blank" rel="noopener" href="https://www.webofscience.com/">Web of Science</a></p><p><a title="Science Direct" target="_blank" rel="noopener" href="https://www.sciencedirect.com/">Science Direct</a></p><p><a title="中国知网" target="_blank" rel="noopener" href="https://www.cnki.net/"><hl></hl>中国知网<hl></hl></a></p></div><div class="footer-links-column"><p><a title="arXiv" target="_blank" rel="noopener" href="https://arxiv.org/">arXiv</a></p><p><a title="JSTOR" target="_blank" rel="noopener" href="https://www.jstor.org/">JSTOR</a></p><p><a title="PubMed Central" target="_blank" rel="noopener" href="https://www.ncbi.nlm.nih.gov/pmc/">PubMed Central</a></p></div><div class="footer-links-column"><p><a title="MSI Eureka" target="_blank" rel="noopener" href="https://search.msi-eureka.com/search">MSI Eureka</a></p><p><a title="GitHub" target="_blank" rel="noopener" href="https://github.com/cerallin/">GitHub</a></p><p><a title="KUKE音乐" target="_blank" rel="noopener" href="https://www.kuke.com/">KUKE<hl></hl>音乐</a></p></div></div><div><span id="site_pv">?</span> PV <span id="site_uv">?</span> UV</div>Copyright © 2021<span class="time-divide">-</span>2026 Cerallin. Power by <a href="https://hexo.io/" target="_blank" rel="external nofollow">Hexo</a> and <a href="https://github.com/Cerallin/hexo-theme-yuzu" target="_blank" rel="external nofollow" title="v3.2.7">Theme Yuzu</a>.</div></div></footer><script>window.config={url_root:"/notes/",meta_path:"meta.json"}</script><script src="/notes/js/theme/back-to-top.js"></script><script src="/notes/js/theme/clipboard.js"></script><script src="/notes/js/theme/loading.js"></script><script src="/notes/js/theme/navbar.js"></script><script src="/notes/js/theme/search.js"></script><script src="/notes/js/theme/toc.js"></script><script src="/notes/js/theme/refs-sidebar.js"></script><script>window.onload=function(){for(var e in Theme)Theme[e].register()}</script></div><div class="search-modal" id="search-modal"><div class="card"><div class="card-head"><div class="search-box"><input class="search-input" id="search-input" placeholder="搜索"><div class="search-button" id="search-button"><div class="icon icon-search"></div></div></div><div class="close-button"><div class="icon icon-x"></div></div></div><div class="card-body"><div class="search-count">共<hl></hl><span id="search-count-num">0</span><hl></hl>条搜索结果。</div><div class="search-result" id="search-result"></div></div></div></div></body></html>